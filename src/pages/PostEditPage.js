// import {React, useState} from "react";
// import styled from "styled-components";
// import { Link, useNavigate, useParams } from "react-router-dom";
// import { useDispatch, useSelector } from "react-redux";
// import { updatePost } from "../redux/modules/post";
// import { carrotGetPost } from "../redux/modules/post";
// import { useEffect } from "react";
// import {Card, Image} from 'react-bootstrap';

// // import ArrowBackOutlinedIcon from "@mui/icons-material/ArrowBackOutlined";

// const PostEditPage = () => {
//   const dispatch = useDispatch();
//   const navigate = useNavigate();
//   const { id } = useParams();
//   const [fileImage, setFileImage] = useState("");  // ÎØ∏Î¶¨Î≥¥Í∏∞Ïä§ÌÖåÏù¥Ìä∏
//   const Detail = useSelector((state) => state.post.post);
//   const [enteredNum, setEnterdNum] = useState();
//   const defaultImage = Detail.imageUrl;
//   const defaultTitle = Detail.title;
//   const defaultPrice = Detail.price;
//   const defaultComment = Detail.contents;



//   //Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞
// //   const [image, setImage] = React.useState("");
// //   //ÏÑúÎ≤ÑÏóê Î≥¥ÎÇ¥Îäî Ïù¥ÎØ∏ÏßÄ url

// //   const [imageUrl, setImageUrl] = React.useState("");

//   const [title, setTitle] = useState(defaultTitle);

//   const [price, setPrice] = useState();

//   const [content, setContent] = useState(defaultComment);






//   const changeTitle = (e) => {
//     setTitle(e.target.value);
//     console.log(e.target.value)
//   };

//   const changePrice = (e) => {
//     setPrice(e.target.value);
//     console.log(e.target.value)


//     let value = e.target.value;
//    value = Number(value.replaceAll(",", ""));
//    if (isNaN(value)) {
//      //NaNÏù∏ÏßÄ ÌåêÎ≥Ñ
//      value = 0;
//    } else {
//      setEnterdNum(value.toLocaleString("ko-KR"));
//    }





//   };

//   const changeContent = (e) => {
//     setContent(e.target.value);
//     console.log(e.target.value)
//   };

//   const changeImageUrl = (e) => {
//     setFileImage(URL.createObjectURL(e.target.files[0]));  //ÎØ∏Ïù¥Î≥¥Í∏∞Í∏∞Îä•


//     setImageUrl(e.target.files[0]);
//     console.log(e.target.files[0])
//   };

//   const submitHandler = () => {










//     // if (imageUrl === "" || title === "" || content === "" || price === "") {
//     //   alert("Î™®Îì† ÏÇ¨Ìï≠ÏùÑ Í∏∞ÏûÖÌï¥Ï£ºÏÑ∏Ïöî.");
//     //   return;
//     // } else {
//     //   dispatch(
//     //     updatePost(id, {
//     //       title: title,

//     //       price: price,
//     //       comment: content,
//     //       file: imageUrl,
//     //     })
//     //   );
//     //   //console.log(imageUrl)
//     //   window.location.href = "/";
//     // }
//   };


//   useEffect(() => {
//     dispatch(carrotGetPost(id));
//   }, []);

//   return (
//     <PostCont>
//       <HeaderNav>
//         <Link to="/">
//           <HeaderBtn>
           
//           </HeaderBtn>
//         </Link>
//         <Title>Ï§ëÍ≥†Í±∞Îûò Í∏ÄÏì∞Í∏∞</Title>
//         {/* <Link to="/main"> */}
//         <HeaderBtn onClick={submitHandler} style={{ color: "#FF8A3C" }}>
//           ÏôÑÎ£å
//         </HeaderBtn>
//         {/* </Link> */}
//       </HeaderNav>

//       <FormBody id="postForm" name="postForm">
//         <Div>
//           <label htmlFor="image">
//           <Card>
//                 {!fileImage && <p style={{paddingTop:"15px"}}>Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞üíæ</p>}
//                 <Image
//                 //  alt="Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞üíæ"
//                  accept="image/*"
//                  src={fileImage}
//                  rounded={true}
//                />
//               </Card>
//             <AddBtn>
//               <p sx={{ fontSize: "40px" }} >ÏàòÏ†ïÌï†ÏÇ¨ÏßÑ</p>
//               <input
              
//                 id="image"
//                 name="image"
//                 type="file"
//                 style={{ display: "none" }}
//                 onChange={(e) => {
//                   changeImageUrl(e);
//                 //   encodeFileToBase64(e.target.files[0]);
//                 }}
//               ></input>
//             </AddBtn>
//           </label>


//           {/* <div style={{ width: "120px", height: "120px", margin: "10px" }}>
//             {image && (
//               <img
//                 src={image}
//                 alt="preview-img"
//                 style={{
//                   width: "100%",
//                   height: "100%",
//                   backgroundSize: "cover",
//                 }}
//               />
//             )}
//           </div> */}

          
//         </Div>
//         <DetailCont>
//           <Input
//             type="text"
//             id="title"
//             name="title"
//             placeholder="Í∏Ä Ï†úÎ™©"
//             onChange={changeTitle}
//             defaultValue={defaultTitle}
//           />
         
//           <Input
//             type="text"
//             id="price"
//             name="price"
//             // placeholder="‚Ç©"
//             onChange={changePrice}
//             // defaultValue={defaultPrice}
//             value={enteredNum || ""}
//           />
//           <label htmlFor="price" />
//         </DetailCont>

//         <label htmlFor="content" />
//         <textarea
//           name="content"
//           id="content"
//           className="content"
//           rows="10"
//           style={{
//             height: "70%",
//             border: "1px solid #FAFAFA",
//             fontSize: "20px",
//             resize: "none",
//             boxSizing: "border-box",
//             padding: "10px",
//           }}
//           placeholder={` Í≤åÏãúÍ∏Ä ÎÇ¥Ïö©ÏùÑ ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî. (Í∞ÄÌíà Î∞è ÌåêÎß§Í∏àÏßÄÌíàÎ™©ÏùÄ Í≤åÏãúÍ∞Ä Ï†úÌïúÎê† Ïàò ÏûàÏñ¥Ïöî.)`}
//           onChange={changeContent}
//           defaultValue={defaultComment}
//         ></textarea>
//       </FormBody>
//     </PostCont>
//   );
// };
// const PostCont = styled.div`
//   width: 720px;
//   box-sizing: border-box;
//   flex-direction: column;
//   display: flex;
//   align-items: center;
//   justify-content: flex-start;
//   border-radius: 10px;
//   background-color: white;
//   height: 600px;
//   gap: 1rem;
//   /* box-shadow: 0px 5px 10px 0px rgba(0, 0, 0, 0.5); */
//   & > * {
//     width: 100%;
//   }
// `;

// const Title = styled.div`
//   font-size: 30px;
//   font-weight: 500;
// `;
// const Div = styled.div`
//   width: 100%;
//   display: flex;
//   /* border-bottom: 1px solid #ddd; */
//   /* padding: 10px 16px; */
//   /* gap: 15px; */
// `;
// const FormBody = styled.form`
//   box-sizing: border-box;
//   flex-direction: column;
//   width: 100%;
//   display: flex;
//   border-bottom: 1px solid #ddd;
//   /* padding: 10px 16px; */
//   /* gap: 15px; */
// `;

// const HeaderNav = styled.div`
//   width: 100%;
//   display: flex;
//   align-items: center;
//   border-bottom: 2px solid #ddd;
//   padding: 10px;
//   justify-content: space-between;
// `;
// const HeaderBtn = styled.button`
//   border: none;
//   background-color: white;
//   width: 50px;
//   height: 50px;
//   font-size: 1rem;
//   font-weight: 500;
//   margin: 0 10px;
//   border-radius: 10px;

//   &:hover {
//     background-color: #eee;
//   }
// `;

// const AddBtn = styled.div`
//   display: flex;
//   align-items: center;
//   justify-content: center;
//   width: 120px;
//   height: 120px;
//   border: 1px solid #ddd;
//   background-color: white;
//   margin: 10px;

//   /* transition: 0.5s; */
//   cursor: pointer;

//   &:hover {
//     background-color: #212123;
//     color: white;
//   }
// `;
// // const UploadImage = styled.img`
// //   width: 120px;
// //   height: 120px;
// //   background-size: cover;
// //   margin: 10px;

// //   /* background-color: #eee; */
// //   background-image: url("https://via.placeholder.com/120");
// // `;

// const DetailCont = styled.div``;

// const Input = styled.input`
//   box-sizing: border-box;
//   font-size: 1.1em;
//   height: 50%;
//   width: 100%;
//   border: 1px solid #fafafa;
//   padding: 15px;
// `;

// export default PostEditPage;







import React from "react";
import styled from "styled-components";
import HeaderBack from "../components/HeaderBack";
import { useEffect } from "react";
import { useNavigate } from "react-router-dom";
import { useDispatch, useSelector } from "react-redux";
import { useState, useRef} from "react";
import {Card, Image} from 'react-bootstrap';
import { carrotPost } from "../redux/modules/post";



const PostEditPage = () => {
   const navigate = useNavigate();
   const dispatch = useDispatch();
   const fileInput = useRef();
   const img_ref = useRef();
   const title_ref = useRef();
   const price_ref = useRef();
   const contents_ref = useRef();
   const chk_ref = useRef();
   // const [category, setCategory] = useState();
   // const [imageSrc, setImageSrc] = useState();
   const [enteredNum, setEnterdNum] = useState();
   // const [price, setPrice] = useState(0);
   const post = useSelector((state) => state.post.postList)

   const [fileImage, setFileImage] = useState("");  // ÎØ∏Î¶¨Î≥¥Í∏∞Ïä§ÌÖåÏù¥Ìä∏
      
  const [fileImgUp, setImage] = useState();    //Î≥¥ÎÇ¥Ï§Ñ ÌååÏùºÏùÑ Ï†ÄÏû•Ìï¥Ï§Ñ state
  
  // Ïπ¥ÌÖåÍ≥†Î¶¨Ï£ºÏÑùÏù¥ÏòÄÏùå
const initialState =  {
   // post_id : 1,
   title: "Ï†úÎ™©1",
   contents:"ÎÇ¥Ïö©1",
   category:"Ïπ¥ÌÖåÍ≥†Î¶¨1",    
   price : "10000",
   imageUrl: "/images/1.png",
   
   }
   const [form, SetForm] = useState(initialState);
   const formData = new FormData();


   const selectFile = async (e) => {

     
     
      setFileImage(URL.createObjectURL(e.target.files[0]));  //ÎØ∏Ïù¥Î≥¥Í∏∞Í∏∞Îä•
      setImage(e.target.files[0])   // ÏÑúÎ≤ÑÏö©

   
 
   };

   const handleChangeState = (e) => {
    // console.log(e.target.name, e.target.value)
      SetForm({
         ...form,
         [e.target.name]: e.target.value,
       });
      // console.log("Îê®")
   }
     
       // Í∏àÏï° ÏΩ§Îßà(,) Ï∞çÍ∏∞
     
       const priceComma = (e) => {
         // setPrice(e.target.value);     // Ïù¥Í∞íÏù¥ Î≥ÄÌïòÎ©¥ Î†åÎçîÎßÅ
         // console.log(e.target.name, e.target.value)
         SetForm({
            ...form,
            [e.target.name]: e.target.value,
          });

         let value = e.target.value;
    value = Number(value.replaceAll(",", ""));
    if (isNaN(value)) {
      //NaNÏù∏ÏßÄ ÌåêÎ≥Ñ
      value = 0;
    } else {
      setEnterdNum(value.toLocaleString("ko-KR"));
    }

        
         // console.log("Îê®")
          
       };
     


       // ÏΩ§ÎßàÏ†úÍ±∞
      //  const commaRemovePrice = enteredNum?.replace(/,/g, ""); // g -> global
      //  let numberPrice = parseInt(commaRemovePrice);
      //  console.log(numberPrice);
     
       const onSubmitHandler = (event) => {
     
         event.preventDefault();
         const modifiedAt = new Date().getTime();
 

         if (form.title.trim() === "" || form.contents.trim() === "" 
         || form.price.trim() === "" || form.imageUrl.trim() === "") return(alert("Î™®Îì†Ïπ∏ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"));
         formData.append(
           "postRequestDto",
           new Blob([JSON.stringify(form)], {
             type: "application/json",
           })
         );
     
         if (fileImgUp !== undefined) {
           formData.append("file", fileImgUp);
         }
         for (let key of formData.keys()) {
            console.log(key, ":", formData.get(key));   //ÌèºÎç∞Ïù¥ÌÑ∞ forÎ¨∏ ÎèåÎ†§ÌôïÏù∏
         }
         
         dispatch(carrotPost(formData));
         
         SetForm(initialState);
         navigate('/main');
       

       };




return (
   <Wrap>
     <Header>
       <button
         size="25"
         onClick={() => {
           navigate("/main");
         }}
       >ÌôàÏúºÎ°ú</button>
       <h3>Ï§ëÍ≥†Í±∞Îûò Í∏ÄÏì∞Í∏∞</h3>
       {/* <h5 onClick={upload}>ÏôÑÎ£å</h5> */}
     </Header>
     <form onSubmit={onSubmitHandler}>
     <Container>
       <File>
         <label htmlFor="file">
           <h4>ÌååÏùº</h4>
         </label>
         <input type="file" id="file" ref={fileInput} onChange={selectFile} name="imageUrl" />
         {/* {imageSrc && <img src={imageSrc} alt="preview-img" />} */}
       </File>

       <Card>
                {!fileImage && <p style={{paddingTop:"15px"}}>Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞üíæ</p>}
                <Image
                //  alt="Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞üíæ"
                 accept="image/*"
                 src={fileImage}
                 rounded={true}
               />
              </Card>

       <div>
         <Title>
           <input name="title" placeholder="Í∏Ä Ï†úÎ™©" ref={title_ref} onChange={handleChangeState}/>
         </Title>
         <Categorie>
            {/* <div>Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÑ†ÌÉù</div> */}
            <select name="category" id="category" onChange={handleChangeState}>
              <option value="none">Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÑ†ÌÉù</option>
              <option value="ÎîîÏßÄÌÑ∏Í∏∞Í∏∞">ÎîîÏßÄÌÑ∏Í∏∞Í∏∞</option>
              <option value="ÏÉùÌôúÍ∞ÄÏ†Ñ">ÏÉùÌôúÍ∞ÄÏ†Ñ</option>
              <option value="Í∞ÄÍµ¨&Ïù∏ÌÖåÎ¶¨Ïñ¥">Í∞ÄÍµ¨/Ïù∏ÌÖåÎ¶¨Ïñ¥</option>
              <option value="Ïú†ÏïÑÎèô">Ïú†ÏïÑÎèô</option>
              <option value="ÏÉùÌôú&Í∞ÄÍ≥µÏãùÌíà">ÏÉùÌôú/Í∞ÄÍ≥µÏãùÌíà</option>
              <option value="Ïú†ÏïÑÎèÑÏÑú">Ïú†ÏïÑÎèÑÏÑú</option>
              <option value="Ïä§Ìè¨Ï∏†/Î†àÏ†Ä">Ïä§Ìè¨Ï∏†/Î†àÏ†Ä</option>
              <option value="Ïó¨ÏÑ±Ìå®ÏÖò">Ïó¨ÏÑ±Ìå®ÏÖò/Ïû°Ìôî</option>
              <option value="ÎÇ®ÏÑ±Ìå®ÏÖò">ÎÇ®ÏÑ±Ìå®ÏÖò/Ïû°Ìôî</option>
              <option value="Í≤åÏûÑ&Ï∑®ÎØ∏">Í≤åÏûÑ/Ï∑®ÎØ∏</option>
              <option value="Î∑∞Ìã∞&ÎØ∏Ïö©">Î∑∞Ìã∞/ÎØ∏Ïö©</option>
              <option value="Î∞òÎ†§ÎèôÎ¨ºÏö©Ìíà">Î∞òÎ†§ÎèôÎ¨ºÏö©Ìíà</option>
              <option value="ÎèÑÏÑú&Ìã∞Ïºì&ÏùåÎ∞ò">ÎèÑÏÑú/Ìã∞Ïºì/ÏùåÎ∞ò</option>
              <option value="Í∏∞ÌÉÄ">Í∏∞ÌÉÄ Ï§ëÍ≥†Î¨ºÌíà</option>
              <option value="ÏÇΩÎãàÎã§">ÏÇΩÎãàÎã§</option>
            </select>
            {/* <IoIosArrowForward /> */}
          </Categorie>

       </div>

       <Price>
         <input
           type="text"
           name="price"
           placeholder="Í∞ÄÍ≤© [ÏÑ†ÌÉùÏÇ¨Ìï≠]"
           ref={price_ref}
           onChange={priceComma}
           value={enteredNum || ""}
         />
         {/* <label htmlFor="price">
           <input  type="checkbox" id="price" ref={chk_ref} />
           Í∞ÄÍ≤© Ï†úÏïàÎ∞õÍ∏∞
         </label> */}
       </Price>

       <textarea
         name="contents"
         cols="40"
         rows="5"
         placeholder="Ïò¨Î¶¥ Í≤åÏãúÍ∏Ä ÎÇ¥Ïö©ÏùÑ ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî. (Í∞ÄÌíà Î∞è ÌåêÎß§Í∏àÏßÄÌíàÎ™©ÏùÄ Í≤åÏãúÍ∞Ä Ï†úÌïúÎê† Ïàò ÏûàÏñ¥Ïöî.)"
         ref={contents_ref}
         onChange={handleChangeState}
       />
       <button className="add-button">Ï∂îÍ∞ÄÌïòÍ∏∞</button>
     </Container>
     </form>
   </Wrap>
 );
}

export default PostEditPage;

const Wrap = styled.div`
  box-sizing: border-box;
  font-size: 13px;

  input {
    font-size: 13px;
  }

  textarea {
    margin-top: 45px;
    border: none;
    outline: none;
    resize: none;
  }
  textarea::placeholder {
    color: #dadada;
    font-size: 13px;
  }
`;
const Header = styled.header`
  display: flex;
  justify-content: space-between;
  align-items: center;

  padding: 16px 15px;
  border-bottom: 1px solid #dadada;

  h4 {
    font-weight: 800;
  }
  h5 {
    color: #ff7e36;
  }
`;
const Container = styled.div`
  padding: 0 16px;
`;

const File = styled.div`
  padding: 30px 0px;
  border-bottom: 1px solid #dadada;

  .camera {
    font-size: 35px;
  }
  label {
    cursor: pointer;
  }
  input[type="file"] {
    display: none;
  }

  img {
    width: 130px;
    height: 130px;
    margin-left: 10px;
    border-radius: 5px;
  }
`;

const Title = styled.div`
  padding: 20px 0px;
  border-bottom: 1px solid #dadada;

  outline: none;
  input {
    border: none;
    outline: none;
  }

  input::placeholder {
    color: #dadada;
  }
`;
const Categorie = styled(Title)`
  display: flex;
  justify-content: space-between;

  select {
    width: 100%;
    border: none;
    outline: none;
    font-size: 14px;
  }
`;

const Locate = styled(Title)`
  display: flex;
  justify-content: space-between;
`;

const Price = styled(Title)`
  display: flex;
  align-items: center;
  justify-content: space-between;

  input[type="checkbox"] {
    accent-color: #ff7e36;
  }
`;


